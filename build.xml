<?xml version="1.0"?>
<!-- ====================================================================== -->
<!-- ====================================================================== -->

<project
    name="Aye Aye Captain!"
    basedir="."
    default="phonegappkg" >

    <taskdef resource="net/sf/antcontrib/antcontrib.properties" >

        <classpath>

            <pathelement location="lib/ant-contrib-1.0b3.jar" />
        </classpath>
    </taskdef>

    <property
        name="build.dir"
        value="build" />

    <property
        name="master-file"
        value="iicaptain" />

    <property
        name="ios-AppID"
        value="140698" />

    <property
        name="bb-AppID"
        value="140898" />

    <property
        name="wp7-AppID"
        value="140903" />

    <property
        name="android-AppID"
        value="105617" />

    <target
        name="phonegappkg"
        depends="prepare.dirs" >

        <exec executable="zip" >

            <arg value="-r" />

            <arg value="${build.dir}/${master-file}" />

            <arg value="www" />
        </exec>

        <foreach
            list="ios,bb,android,wp7"
            param="os"
            target="addOSSpecifics" >
        </foreach>
    </target>

    <target
        name="upload"
        depends="phonegappkg" >

        <foreach
            list="ios,bb,android,wp7"
            param="os"
            target="upload-os-pkg" >
        </foreach>
    </target>

    <target
        name="addOSSpecifics"
        depends="" >

        <copy
            file="${build.dir}/${master-file}.zip"
            tofile="${build.dir}/${master-file}-${os}.zip" >
        </copy>

        <zip
            basedir="phonegap/${os}"
            destfile="${build.dir}/${master-file}-${os}.zip"
            update="true" >
        </zip>
    </target>

    <target name="upload-os-pkg" >

        <switch value="${os}" >

            <case value="ios" >

                <var
                    name="id"
                    value="${ios-AppID}" />
            </case>

            <case value="android" >

                <var
                    name="id"
                    value="${android-AppID}" />
            </case>

            <case value="bb" >

                <var
                    name="id"
                    value="${bb-AppID}" />
            </case>

            <case value="wp7" >

                <var
                    name="id"
                    value="${wp7-AppID}" />
            </case>
        </switch>

        <exec executable="curl" >

            <arg value="-F" />

            <arg value="file=@${build.dir}/${master-file}-${os}.zip" />

            <arg value="-X" />

            <arg value="PUT" />

            <arg value="https://build.phonegap.com/api/v1/apps/${id}?auth_token=i1c3E6MMYymBTe1Y6mBN" />
        </exec>
    </target>

    <target name="clean" >

        <delete dir="${build.dir}" />
    </target>

    <target name="prepare.dirs" >

        <mkdir dir="${build.dir}" />
    </target>

</project>